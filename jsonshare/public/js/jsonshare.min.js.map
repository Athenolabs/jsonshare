{"version":3,"file":"jsonshare.min.js","sources":["../../../../apps/jsonshare/jsonshare/public/js/jsonshare.js"],"sourcesContent":["// Copyright (c) 2019, Si Hay Sistema and contributors\n// For license information, please see license.txt\n\nfunction compartir_item(frm, doctype, codigo) {\n    // Agrega un boton llamado share\n    frm.add_custom_button(__('Share'), function () {\n        // Llama al metodo python para obtener un listado con los\n        // usuarios configurados\n        frappe.call({\n            method: \"jsonshare.utils.obtener_usuarios\",\n            callback: function (response) {\n                // Crea un Modal(dialogo), en las opciones del campo\n                // user_share se asigna el listado de usarios retornados\n                let dialog = new frappe.ui.Dialog({\n                    title: __('Compartir Item'),\n                    fields: [\n                        {\n                            fieldtype: 'Select',\n                            fieldname: 'user_share',\n                            label: __('Seleccione Usuario'),\n                            reqd: true,\n                            options: response.message,\n                            description: __('Seleccione el host/usuario con quien quiera compartir el Item')\n                        },\n                        {\n                            fieldtype: 'Button',\n                            fieldname: 'btn_share',\n                            label: __('Compartir'),\n                            options: '',\n                            description: __(''),\n                        }\n                    ]\n                });\n\n                // Muestra el dialogo\n                dialog.show();\n\n                // Agrega un event lister al boton compartir del dialogo\n                dialog.fields_dict.btn_share.$wrapper.on('click', function (e) {\n                    // console.log('Eso es');\n                    // Imprime el valor seleccionado\n                    console.log(dialog.fields_dict.user_share.value);\n                    // Imprime el codigo del item a ser enviado\n                    //console.log(frm.doc.item_code);\n                    frappe.call({\n                        method: \"jsonshare.api_data.obtener_datos\",\n                        args: {\n                            item: codigo,\n                            usuario: dialog.fields_dict.user_share.value,\n                            doctype: doctype\n                        },\n                        callback: function () {\n                            // frm.reload_doc();\n                        }\n                    });\n                });\n            }\n        });\n\n    }).addClass(\"btn-success\");\n}\n\nfrappe.ui.form.on(\"Item\", {\n    refresh: function (frm) {\n        let item_code = frm.doc.item_code;\n        compartir_item(frm, 'Item', item_code);\n    }\n});\n\nfrappe.ui.form.on(\"Customer\", {\n    refresh: function (frm) {\n        let customer_name = frm.doc.customer_name;\n        compartir_item(frm, 'Customer', customer_name);\n    }\n});\n\nfrappe.ui.form.on(\"Supplier\", {\n    refresh: function (frm) {\n        let supplier_name = frm.doc.supplier_name;\n        compartir_item(frm, 'Supplier', supplier_name);\n    }\n});"],"names":["compartir_item","frm","doctype","codigo","add_custom_button","__","frappe","call","method","callback","response","let","dialog","ui","Dialog","title","fields","fieldtype","fieldname","label","reqd","options","message","description","show","fields_dict","btn_share","$wrapper","on","e","console","log","user_share","value","args","item","usuario","addClass","form","refresh","doc","item_code","customer_name","supplier_name"],"mappings":"yBAGA,SAASA,EAAeC,EAAKC,EAASC,GAElCF,EAAIG,kBAAkBC,GAAG,SAAU,WAG/BC,OAAOC,MACHC,OAAQ,mCACRC,SAAU,SAAUC,GAGhBC,IAAIC,EAAS,IAAIN,OAAOO,GAAGC,QACvBC,MAAOV,GAAG,kBACVW,SAEQC,UAAW,SACXC,UAAW,aACXC,MAAOd,GAAG,sBACVe,MAAM,EACNC,QAASX,EAASY,QAClBC,YAAalB,GAAG,mEAGhBY,UAAW,SACXC,UAAW,YACXC,MAAOd,GAAG,aACVgB,QAAS,GACTE,YAAalB,GAAG,QAM5BO,EAAOY,OAGPZ,EAAOa,YAAYC,UAAUC,SAASC,GAAG,QAAS,SAAUC,GAGxDC,QAAQC,IAAInB,EAAOa,YAAYO,WAAWC,OAG1C3B,OAAOC,MACHC,OAAQ,mCACR0B,MACIC,KAAMhC,EACNiC,QAASxB,EAAOa,YAAYO,WAAWC,MACvC/B,QAASA,GAEbO,SAAU,sBAQ3B4B,SAAS,eAGhB/B,OAAOO,GAAGyB,KAAKV,GAAG,QACdW,QAAS,SAAUtC,GAEfD,EAAeC,EAAK,OADJA,EAAIuC,IAAIC,cAKhCnC,OAAOO,GAAGyB,KAAKV,GAAG,YACdW,QAAS,SAAUtC,GAEfD,EAAeC,EAAK,WADAA,EAAIuC,IAAIE,kBAKpCpC,OAAOO,GAAGyB,KAAKV,GAAG,YACdW,QAAS,SAAUtC,GAEfD,EAAeC,EAAK,WADAA,EAAIuC,IAAIG"}